{"version":3,"sources":["../src/index.ts","../src/lmnt-provider.ts","../src/lmnt-speech-model.ts","../src/lmnt-error.ts","../src/version.ts"],"sourcesContent":["export { createLMNT, lmnt } from './lmnt-provider';\nexport type { LMNTProvider, LMNTProviderSettings } from './lmnt-provider';\nexport { VERSION } from './version';\n","import { SpeechModelV2, ProviderV2 } from '@ai-sdk/provider';\nimport {\n  FetchFunction,\n  loadApiKey,\n  withUserAgentSuffix,\n} from '@ai-sdk/provider-utils';\nimport { LMNTSpeechModel } from './lmnt-speech-model';\nimport { LMNTSpeechModelId } from './lmnt-speech-options';\nimport { VERSION } from './version';\n\nexport interface LMNTProvider extends Pick<ProviderV2, 'speechModel'> {\n  (\n    modelId: 'aurora',\n    settings?: {},\n  ): {\n    speech: LMNTSpeechModel;\n  };\n\n  /**\nCreates a model for speech synthesis.\n   */\n  speech(modelId: LMNTSpeechModelId): SpeechModelV2;\n}\n\nexport interface LMNTProviderSettings {\n  /**\nAPI key for authenticating requests.\n     */\n  apiKey?: string;\n\n  /**\nCustom headers to include in the requests.\n     */\n  headers?: Record<string, string>;\n\n  /**\nCustom fetch implementation. You can use it as a middleware to intercept requests,\nor to provide a custom fetch implementation for e.g. testing.\n    */\n  fetch?: FetchFunction;\n}\n\n/**\nCreate an LMNT provider instance.\n */\nexport function createLMNT(options: LMNTProviderSettings = {}): LMNTProvider {\n  const getHeaders = () =>\n    withUserAgentSuffix(\n      {\n        'x-api-key': loadApiKey({\n          apiKey: options.apiKey,\n          environmentVariableName: 'LMNT_API_KEY',\n          description: 'LMNT',\n        }),\n        ...options.headers,\n      },\n      `ai-sdk/lmnt/${VERSION}`,\n    );\n\n  const createSpeechModel = (modelId: LMNTSpeechModelId) =>\n    new LMNTSpeechModel(modelId, {\n      provider: `lmnt.speech`,\n      url: ({ path }) => `https://api.lmnt.com${path}`,\n      headers: getHeaders,\n      fetch: options.fetch,\n    });\n\n  const provider = function (modelId: LMNTSpeechModelId) {\n    return {\n      speech: createSpeechModel(modelId),\n    };\n  };\n\n  provider.speech = createSpeechModel;\n  provider.speechModel = createSpeechModel;\n\n  return provider as LMNTProvider;\n}\n\n/**\nDefault LMNT provider instance.\n */\nexport const lmnt = createLMNT();\n","import { SpeechModelV2, SpeechModelV2CallWarning } from '@ai-sdk/provider';\nimport {\n  combineHeaders,\n  createBinaryResponseHandler,\n  parseProviderOptions,\n  postJsonToApi,\n} from '@ai-sdk/provider-utils';\nimport { z } from 'zod/v4';\nimport { LMNTConfig } from './lmnt-config';\nimport { lmntFailedResponseHandler } from './lmnt-error';\nimport { LMNTSpeechModelId } from './lmnt-speech-options';\nimport { LMNTSpeechAPITypes } from './lmnt-api-types';\n\n// https://docs.lmnt.com/api-reference/speech/synthesize-speech-bytes\nconst lmntSpeechCallOptionsSchema = z.object({\n  /**\n   * The model to use for speech synthesis e.g. 'aurora' or 'blizzard'.\n   * @default 'aurora'\n   */\n  model: z\n    .union([z.enum(['aurora', 'blizzard']), z.string()])\n    .nullish()\n    .default('aurora'),\n\n  /**\n   * The audio format of the output.\n   * @default 'mp3'\n   */\n  format: z\n    .enum(['aac', 'mp3', 'mulaw', 'raw', 'wav'])\n    .nullish()\n    .default('mp3'),\n\n  /**\n   * The sample rate of the output audio in Hz.\n   * @default 24000\n   */\n  sampleRate: z\n    .union([z.literal(8000), z.literal(16000), z.literal(24000)])\n    .nullish()\n    .default(24000),\n\n  /**\n   * The speed of the speech. Range: 0.25 to 2.\n   * @default 1\n   */\n  speed: z.number().min(0.25).max(2).nullish().default(1),\n\n  /**\n   * A seed value for deterministic generation.\n   */\n  seed: z.number().int().nullish(),\n\n  /**\n   * Whether to use a conversational style.\n   * @default false\n   */\n  conversational: z.boolean().nullish().default(false),\n\n  /**\n   * Maximum length of the output in seconds (up to 300).\n   */\n  length: z.number().max(300).nullish(),\n\n  /**\n   * Top-p sampling parameter. Range: 0 to 1.\n   * @default 1\n   */\n  topP: z.number().min(0).max(1).nullish().default(1),\n\n  /**\n   * Temperature for sampling. Higher values increase randomness.\n   * @default 1\n   */\n  temperature: z.number().min(0).nullish().default(1),\n});\n\nexport type LMNTSpeechCallOptions = z.infer<typeof lmntSpeechCallOptionsSchema>;\n\ninterface LMNTSpeechModelConfig extends LMNTConfig {\n  _internal?: {\n    currentDate?: () => Date;\n  };\n}\n\nexport class LMNTSpeechModel implements SpeechModelV2 {\n  readonly specificationVersion = 'v2';\n\n  get provider(): string {\n    return this.config.provider;\n  }\n\n  constructor(\n    readonly modelId: LMNTSpeechModelId,\n    private readonly config: LMNTSpeechModelConfig,\n  ) {}\n\n  private async getArgs({\n    text,\n    voice = 'ava',\n    outputFormat = 'mp3',\n    speed,\n    language,\n    providerOptions,\n  }: Parameters<SpeechModelV2['doGenerate']>[0]) {\n    const warnings: SpeechModelV2CallWarning[] = [];\n\n    // Parse provider options\n    const lmntOptions = await parseProviderOptions({\n      provider: 'lmnt',\n      providerOptions,\n      schema: lmntSpeechCallOptionsSchema,\n    });\n\n    // Create request body\n    const requestBody: Record<string, unknown> = {\n      model: this.modelId,\n      text,\n      voice,\n      response_format: 'mp3',\n      speed,\n    };\n\n    if (outputFormat) {\n      if (['mp3', 'aac', 'mulaw', 'raw', 'wav'].includes(outputFormat)) {\n        requestBody.response_format = outputFormat;\n      } else {\n        warnings.push({\n          type: 'unsupported-setting',\n          setting: 'outputFormat',\n          details: `Unsupported output format: ${outputFormat}. Using mp3 instead.`,\n        });\n      }\n    }\n\n    // Add provider-specific options\n    if (lmntOptions) {\n      const speechModelOptions: Omit<LMNTSpeechAPITypes, 'voice' | 'text'> = {\n        conversational: lmntOptions.conversational ?? undefined,\n        length: lmntOptions.length ?? undefined,\n        seed: lmntOptions.seed ?? undefined,\n        speed: lmntOptions.speed ?? undefined,\n        temperature: lmntOptions.temperature ?? undefined,\n        top_p: lmntOptions.topP ?? undefined,\n        sample_rate: lmntOptions.sampleRate ?? undefined,\n      };\n\n      for (const key in speechModelOptions) {\n        const value =\n          speechModelOptions[\n            key as keyof Omit<LMNTSpeechAPITypes, 'voice' | 'text'>\n          ];\n        if (value !== undefined) {\n          requestBody[key] = value;\n        }\n      }\n    }\n\n    if (language) {\n      requestBody.language = language;\n    }\n\n    return {\n      requestBody,\n      warnings,\n    };\n  }\n\n  async doGenerate(\n    options: Parameters<SpeechModelV2['doGenerate']>[0],\n  ): Promise<Awaited<ReturnType<SpeechModelV2['doGenerate']>>> {\n    const currentDate = this.config._internal?.currentDate?.() ?? new Date();\n    const { requestBody, warnings } = await this.getArgs(options);\n\n    const {\n      value: audio,\n      responseHeaders,\n      rawValue: rawResponse,\n    } = await postJsonToApi({\n      url: this.config.url({\n        path: '/v1/ai/speech/bytes',\n        modelId: this.modelId,\n      }),\n      headers: combineHeaders(this.config.headers(), options.headers),\n      body: requestBody,\n      failedResponseHandler: lmntFailedResponseHandler,\n      successfulResponseHandler: createBinaryResponseHandler(),\n      abortSignal: options.abortSignal,\n      fetch: this.config.fetch,\n    });\n\n    return {\n      audio,\n      warnings,\n      request: {\n        body: JSON.stringify(requestBody),\n      },\n      response: {\n        timestamp: currentDate,\n        modelId: this.modelId,\n        headers: responseHeaders,\n        body: rawResponse,\n      },\n    };\n  }\n}\n","import { z } from 'zod/v4';\nimport { createJsonErrorResponseHandler } from '@ai-sdk/provider-utils';\n\nexport const lmntErrorDataSchema = z.object({\n  error: z.object({\n    message: z.string(),\n    code: z.number(),\n  }),\n});\n\nexport type LMNTErrorData = z.infer<typeof lmntErrorDataSchema>;\n\nexport const lmntFailedResponseHandler = createJsonErrorResponseHandler({\n  errorSchema: lmntErrorDataSchema,\n  errorToMessage: data => data.error.message,\n});\n","// Version string of this package injected at build time.\ndeclare const __PACKAGE_VERSION__: string | undefined;\nexport const VERSION: string =\n  typeof __PACKAGE_VERSION__ !== 'undefined'\n    ? __PACKAGE_VERSION__\n    : '0.0.0-test';\n"],"mappings":"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","names":["import_provider_utils","import_provider_utils","import_v4"]}